//
//  main.c
//  TestHttpDecodeDemo
//
//  Created by on 2017/6/15.
//  Copyright © 2017年 lee.ying. All rights reserved.
//

#include <stdio.h>
#include <string.h>
#include "CommonHeader.h"

char hexToChar(char *hex)
{
    char c1,c2;
    char c = *hex;
    
    if (c >= '0' && c <= '9')
    {
        c1 = c - '0';
    }
    else if (c >= 'A' && c <= 'F')
    {
        c1 = c - 'A' + 10;
    }
    else if (c >= 'a' && c <= 'f')
    {
        c1 = c - 'a' + 10;
    }
    else
    {
        return 0;
    }
    
    hex++;
    c = *hex;
    if (c >= '0' && c <= '9')
    {
        c2 = c - '0';
    }
    else if (c >= 'A' && c <= 'F')
    {
        c2 = c - 'A' + 10;
    }
    else if (c >= 'a' && c <= 'f')
    {
        c2 = c - 'a' + 10;
    }
    else
    {
        return 0;
    }
    
    return (char)(((unsigned char)c1 << 4)+c2);
}


int testHttpDecode(char* pData, int dataLen, char* pDecodeData, int *decodeDataLen)
{
    if ((NULL == pData) || (NULL == pDecodeData)) return FALSE;
    
    if ((0x47 == pData[0]) || (0x45 == pData[1]) || (0x54 == pData[2]) || (0x20 == pData[3]))
    {
        int startIndex = 0;
        int endIndex = 0;
        int decodeDataIndex = 0;
        
        while ('%' != pData[startIndex]) startIndex++;
        if(startIndex >= dataLen) return FALSE;
        printf("startIndex = %i.\n", startIndex);
        
        endIndex = startIndex;
        while('%' == pData[endIndex]) endIndex+=3;
        if (endIndex > dataLen) return FALSE;
        printf("endIndex = %i.\n", endIndex);
        
        int dataIndex = 0;
        char ch = 0;
        char tempChar[] = {0, 0};
        int tempCharIndex = 0;
        for (dataIndex = startIndex + 1; dataIndex < endIndex; dataIndex++)
        {
            ch = pData[dataIndex];
            printf("dataIndex = %i.\n", dataIndex);
            if (ch != '%')
            {
                tempChar[tempCharIndex] = ch;
                tempCharIndex++;
                continue;
            }
            else{
                pDecodeData[decodeDataIndex] = hexToChar(tempChar);
                tempCharIndex = 0;
                decodeDataIndex++;
                (*decodeDataLen)++;
            }
        }
        pDecodeData[decodeDataIndex] = '\0';
    }
    
    return TRUE;
}
/*
int main()
{
    char pData[]={0x30, 0x30};
    unsigned long dataLen = strlen(pData);
    char result;
    result = hexToChar(pData);
    printf("result = %02x.\n", result & 0xff);
    
    return 0;
}
*/

int main(int argc, const char * argv[]) {
    /*
    char pData[] = {0x47, 0x45, 0x54, 0x20, 0x2f, 0x73, 0x3f, 0x69, 0x65, 0x3d,
                    0x75, 0x74, 0x66, 0x2d, 0x38, 0x26, 0x66, 0x3d, 0x38, 0x26,
                    0x72, 0x73, 0x76, 0x5f, 0x62, 0x70, 0x3d, 0x31, 0x26, 0x72,
                    0x73, 0x76, 0x5f, 0x69, 0x64, 0x78, 0x3d, 0x31, 0x26, 0x63,
                    0x68, 0x3d, 0x26, 0x62, 0x61, 0x72, 0x3d, 0x26, 0x77, 0x64,
                    0x3d, 0x25, 0x38, 0x33, 0x25, 0x30, 0x36, 0x25, 0x63, 0x66,
                    0x25, 0x32, 0x64, 0x25, 0x66, 0x30, 0x25, 0x33, 0x34, 0x25,
                    0x36, 0x34, 0x25, 0x36, 0x30, 0x25, 0x33, 0x66, 0x25, 0x37,
                    0x36, 0x25, 0x62, 0x33, 0x25, 0x39, 0x37, 0x25, 0x34, 0x66,
                    0x25, 0x36, 0x65, 0x25, 0x39, 0x31, 0x25, 0x39, 0x66, 0x25,
                    0x39, 0x66, 0x25, 0x65, 0x63, 0x25, 0x37, 0x31, 0x25, 0x30,
                    0x30, 0x25, 0x36, 0x34, 0x25, 0x35, 0x66, 0x25, 0x39, 0x65,
                    0x25, 0x39, 0x38, 0x25, 0x61, 0x34, 0x25, 0x61, 0x32, 0x25,
                    0x35, 0x30, 0x25, 0x38, 0x62, 0x25, 0x38, 0x61, 0x25, 0x30,
                    0x39, 0x25, 0x38, 0x65, 0x25, 0x33, 0x61, 0x25, 0x38, 0x35,
                    0x25, 0x32, 0x31, 0x25, 0x37, 0x32, 0x25, 0x61, 0x38, 0x25,
                    0x35, 0x64, 0x25, 0x37, 0x61, 0x25, 0x32, 0x61, 0x25, 0x38,
                    0x37, 0x25, 0x30, 0x34, 0x25, 0x63, 0x37, 0x25, 0x33, 0x65,
                    0x25, 0x33, 0x38, 0x25, 0x35, 0x64, 0x25, 0x33, 0x36, 0x25,
                    0x64, 0x64, 0x25, 0x36, 0x36, 0x25, 0x65, 0x30, 0x25, 0x38,
                    0x38, 0x25, 0x39, 0x31, 0x25, 0x65, 0x66, 0x25, 0x37, 0x64,
                    0x25, 0x34, 0x35, 0x25, 0x63, 0x39, 0x25, 0x34, 0x31, 0x25,
                    0x39, 0x34, 0x25, 0x38, 0x64, 0x25, 0x31, 0x35, 0x25, 0x32,
                    0x61, 0x25, 0x61, 0x32, 0x25, 0x64, 0x38, 0x25, 0x30, 0x61,
                    0x25, 0x32, 0x64, 0x25, 0x62, 0x63, 0x26, 0x72, 0x6e, 0x3d};
     */
  

    char pData[] = {0x47, 0x45, 0x54, 0x20, 0x25, 0x62, 0x63, 0x26, 0x72, 0x6e, 0x3d};

    
    unsigned long dataLen = strlen(pData);
    printf("dataLen = %lu.\n", dataLen);
    
    int decodeDataLen = 0;
    char pDecodeData[320] = {0, 0, 0, 0};
    testHttpDecode(pData, (int)dataLen, pDecodeData, &decodeDataLen);
    
    printf("decodeDataLen = %i.\n", decodeDataLen);
    for (int i = 0;i < decodeDataLen; i++)
    {
        printf(" %02x",pDecodeData[i] & 0xff);
    }
    printf("\n");
    
    printf("Hello, World!\n");
    return 0;
}
